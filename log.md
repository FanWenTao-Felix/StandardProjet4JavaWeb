### 染色日志是怎么实现
作者：匿名用户
链接：http://www.zhihu.com/question/20292868/answer/21643316
来源：知乎
著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。

底层的rpc框架实现的，其实就是给每一次请求的源头处，加上一个seqence id（id内容可以是qq号+时间戳+随机数），每次记日志的时候，都打把seqence id打出来，rpc调用的时候，由于跨机器了，需要在rpc消息中把这个seqence id传过去，rpc服务器接收到消息，同时打印的所有日志也都带着这个seqence id。这样所有的服务（不管你有多少台服务器）处理同一个请求的时候，就会打印出相同的seqence id，再由一个统一的服务去收集这些日志，把相同id的日志收集到一起，按时间排序，汇总给程序员看，就能看到一次请求发起后，所有的rpc服务器打印的日志了。

这只是一个简单的思想，腾讯手机浏览器这边应该是有个日志服务器，所有的日志都打到这个服务器上，省去了去其它服务器上收集日志的过程，相当于日志是主动push过来的。也不是所有的请求都会打印日志，那样太耗时了。只针对某些qq号的请求才打印日志，便于调试，这个qq号的列表应该是可以在线动态修改的。

所以说，当出现问题的时候，先把测试用的qq号加到染色列表中，每台rpc服务器会定期加载这个染色列表。发起一个请求，后台涉及到的所有rpc服务器在处理这个请求时都会写对应的日志。程序员就去日志服务那里看到所有的日志就可以了。不用一台一台机器去找日志。


---

